---
# This file is part of Ansible role geoffreyvanwyk.moodle.
#
# Ansible role geoffreyvanwyk.moodle is free software: you can redistribute it
# and/or modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Ansible role geoffreyvanwyk.moodle is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
# Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# Ansible role geoffreyvanwyk.moodle. If not, see <https://www.gnu.org/licenses/>.

##
# Information for Ansible Galaxy.
#
# @copyright  2023 Geoffrey Bernardo van Wyk (https://geoffreyvanwyk.dev)
##

galaxy_info:
  namespace: geoffreyvanwyk
  role_name: moodle
  description: Deploys, installs, and upgrades Moodle.
  author: Geoffrey Bernardo van Wyk

  # Choose a valid license ID from https://spdx.org - some suggested licenses:
  # - BSD-3-Clause (default)
  # - MIT
  # - GPL-2.0-or-later
  # - GPL-3.0-only
  # - Apache-2.0
  # - CC-BY-4.0
  license: GPL-3.0-or-later

  min_ansible_version: "2.10"

  # If this a Container Enabled role, provide the minimum Ansible Container version.
  # min_ansible_container_version:

  #
  # Provide a list of supported platforms, and for each platform a list of versions.
  # If you don't wish to enumerate all versions for a particular platform, use 'all'.
  # To view available platforms and versions (or releases), visit:
  # https://galaxy.ansible.com/api/v1/platforms/
  #
  # platforms:
  # - name: Ubuntu
  #   versions:
  #   - all
  #   - focal
  #   - jammy
  # - name: Fedora
  #   versions:
  #   - all
  #   - 25
  # - name: SomePlatform
  #   versions:
  #   - all
  #   - 1.0
  #   - 7
  #   - 99.99

  galaxy_tags: []
    # List tags for your role here, one per line. A tag is a keyword that describes
    # and categorizes the role. Users find roles by searching for tags. Be sure to
    # remove the '[]' above, if you add tags to this list.
    #
    # NOTE: A tag is limited to a single word comprised of alphanumeric characters.
    #       Maximum 20 tags per role.

dependencies:
  # List your role dependencies here, one per line. Be sure to remove the '[]' above,
  # if you add dependencies to this list.
  - role: geoffreyvanwyk.php
    become: yes
    # php_version
    # The PHP version depends on the requested Moodle version. The php_version
    # variable is calculated in vars/main.yml and not here because it is also
    # needed in other parts of the role.
    php_mod_enabled:
      # The list of required and recommended PHP extensions (modules) for a
      # particular Moodle version can be found on page
      # Site Administration >  Server > Environment of any Moodle instance
      # (See https://sandbox.moodledemo.net).
      #
      # The Moodle role installs both required and recommended extensions.
      #
      # The following extensions are part of PHP core or compiled into PHP (e.g.
      # openssl); as such they are installed as part of the php Ubuntu package.
      # When attempting to install them, the error
      # "No package matching 'php{php_version}-{mod}' is available" is raised,
      # or "'php{php_version}-{mod}' has no installation candidate" and that the
      # package is virtual, e.g. json. See
      # https://www.debian.org/doc/manuals/debian-faq/pkg-basics.en.html#virtual
      #
      # - hash    https://www.php.net/manual/en/hash.requirements.php
      # - json    https://www.php.net/manual/en/json.requirements.php
      # - openssl https://www.php.net/manual/en/openssl.installation.php
      # - pcre    https://www.php.net/manual/en/pcre.installation.php
      # - sodium  https://www.php.net/manual/en/sodium.installation.php
      # - spl     https://www.php.net/manual/en/spl.installation.php
      # - zlib    https://www.php.net/manual/en/zlib.installation.php
      - ctype
      - curl
      - dom
      - exif
      - fileinfo
      - fpm # The Moodle role uses PHP with the FastCGI PHP module.
      - gd
      - iconv
      - intl
      - mbstring
      - simplexml
      - soap
      - tokenizer
      - xml
      - xmlreader
      - zip
    php_ini_cli:
      # The list of required and recommended PHP settings for a particular
      # Moodle version can be found on page
      # Site Administration >  Server > Environment of any Moodle instance
      # (See https://sandbox.moodledemo.net).
      #
      # Additional settings can be found on the Release Notes page for a particular version.
      # (See https://moodledev.io/general/releases)
      - name: max_input_vars
        value: 5000
    php_ini_fpm:
      # The list of required and recommended PHP settings for a particular
      # Moodle version can be found on page
      # Site Administration >  Server > Environment of any Moodle instance
      # (See https://sandbox.moodledemo.net).
      - name: max_input_vars
        value: 5000 # Default: 1000
      - name: file_uploads
        value: On
      - name: opcache.enable
        value: 1
      # - name: memory_limit
      #   value: 96M # Default: 128M
